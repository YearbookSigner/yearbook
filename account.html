<!DOCTYPE html5>
<html>
  <head>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
    <style>
      .center {
        margin: auto;
        width: 80%;
      }

      .loginButton {
        margin: auto;
        width: 20%;
        padding: 20px;
        background-color: #d0d0d0;
        border: none;
        color: black;
        border-radius: 40px;
        font-size: 15;
      }

      .inputField {
        margin: auto;
        width: 79.5%;
        padding: 20px;
        background-color: #d0d0d0;
        border: none;
        color: black;
        border-radius: 40px;
        font-size: 15;
      }

      .listItem {
        margin: auto;
        width: 95%;
        padding: 5px;
        background-color: #f0f0f0;
        border: none;
        color: black;
        border-radius: 40px;
        font-size: 15;
      }
      .boldHeader {
        font-weight: bold;
        font-size: 20;
        font-family: 'Ubuntu', sans-serif;
        text-align: center;
      }

      .content {
        margin: auto;
        width: 80%;
        min-width: 300px;
        padding: 20px;
        background-color: #97dbd5;
        border: none;
        border-radius: 40px;
        transform: translateY(100px);
      }

      .centeredText {
        text-align: center;
        font-family: 'Ubuntu', sans-serif;
      }

      .bg {
        background-image: url("bg.png");
        max-width: 100%;
        height: 100%;
      }

      .thumbnail {
        background-image: url("1.png");
        max-width: 25%;
        height: 50%;
        margin: 0 auto;
        object-fit: cover;
      }

    </style>
  </head>
  <body>
    <div id="bg" class="bg">
      <div id="content" class="content">
        <p class="boldHeader" id="title">UserName</p>
        <a href="yearbook/index.html">
          <div id="yearbokthumbnail" class="thumbnail"></div>
        </a>
        <br />
        <div id="user-list">
          <div class="listItem">
              <input type="text" class="inputField" id="signInput"></input>
              <button class="loginButton" onclick="sign()">Click to sign!</button>
          </div>
          <p class="centeredText">Sign in this format: Good luck - Ryan</p>
        </div>
      </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-firestore.js"></script>

    <script>

      var title = document.getElementById("title");
      var list = document.getElementById("user-list")
      var inputField = document.getElementById("signInput")

      const queryString = window.location.search;
      console.log(queryString);
      const urlParams = new URLSearchParams(queryString);
      const name = urlParams.get('userid')
      console.log(name);

      title.innerHTML = name;

      var firebaseConfig = {
        apiKey: "AIzaSyA2Fj-ElygZquh5wqoENTh1TSXPPWGuzKA",
        authDomain: "yearbooksigner.firebaseapp.com",
        databaseURL: "https://yearbooksigner.firebaseio.com",
        projectId: "yearbooksigner",
        storageBucket: "yearbooksigner.appspot.com",
        messagingSenderId: "214118912916",
        appId: "1:214118912916:web:9f6d418e7d5bab8c5ab581"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      var db = firebase.firestore();

      db.collection("users").doc(name).collection("signed").get().then(function(querySnapshot) {
        querySnapshot.forEach(function(doc) {
          var user = doc.data();
          var li = document.createElement("div");
          var text = document.createElement("p");
          text.appendChild(document.createTextNode(user.sign));
          text.setAttribute('class', "centeredText")
          li.setAttribute('id', user.sign);
          li.setAttribute('class', "listItem");
          li.appendChild(text);
          list.appendChild(li);
          list.appendChild(document.createElement("br"));
        });
      });

      function sign() {
        console.log(inputField.value);
        if (inputField.value != "") {
          var split = inputField.value.split("-");
          db.collection("users").doc(name).collection("signed").doc(split[1]).set({
              sign: inputField.value,
          })
          setTimeout(() => { location.reload(); }, 2000);
        }

      }

    </script>
  </body>
</html>
